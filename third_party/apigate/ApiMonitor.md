API Monitor Service
=============

# 概述

要解决的需求：

* 整体请求异常检测（请求量下降检测、请求错误码个数检测）
* 某个用户的异常状况检测
* 灰度发布的异常检测
* 某个地区流量异常的检测

# 设计思路

* 以T为周期（比如5秒）对某个量进行统计。每隔T时间发送一次所有统计量的报告。
* 但考虑到统计数据的总量有时可能会比较大，此时应该设计当统计量的条目数>阀值时也发送报告。
* 统计值：(id, t, mod, api, k, v)
  * id: 本统计值的id。有全局唯一性，可用来防止该统计量被重复统计。
  * t: 该统计值的基准时间，本统计值统计的是 [t0, t0+T) 之间的数据（在这个时间段内的统计值通常是一条，但不能假设）。
  * mod: 该统计值所属模块（服务）。
  * api: 该统计值针对的api。
  * k: 该统计值的名称。
  * v: 该统计值的值。
* 更一般化的统计值：(id=xxx, t=xxx, f1=xxx, f2=xxx, ..., fN=xxx, v1=xxx, v2=xxx, ..., vM=xxx)
  * id: 本统计值的id。有全局唯一性，可用来防止该统计量被重复统计。可选字段，如果没有表示不防重。
  * t: 该统计值的基准时间，本统计值统计的是 [t0, t0+T) 之间的数据（在这个时间段内的统计值通常是一条，但不能假设）。
  * f: 该统计值的某个量，这个量的值为枚举值（或者说是文本类型）。比如上面的mod、api、k都算。
  * v: 该统计值的某个量，这个量的值为数值类型。如请求次数、流量、耗时。我们不鼓励增加不可叠加的统计量，如速度。
* 统计值会被发送到 API Monitor 服务，该服务完成统计数据的存储、报警处理。

# 存储设计


