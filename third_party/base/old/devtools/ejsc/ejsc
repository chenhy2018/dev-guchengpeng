#!/usr/bin/env ruby

require "rubygems"
require "erubis/main"

raise "Usage: ejsc <File.ejs>" unless ARGV.length == 1

s = File.read(ARGV[0])
i = s.index("\n")

s1 = s.slice(0, i)

raise "Except # at first line" unless s1.slice(0, 1) == "#"

s2 = s.slice(i+1 .. -1).strip!

engine = Erubis::Ejavascript.new(s2, :docwrite=>false)

c_src =  engine.src

puts s1.slice(1 .. -1);
puts "{\n"
puts c_src.gsub("\n_buf.join(\"\")", "\nreturn _buf.join(\"\")")
puts "}\n\n"
