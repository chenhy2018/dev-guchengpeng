package jpeg

import (
	"testing"

	"github.com/stretchr/testify/assert"
)

type quantTbls struct {
	tbls [2][]byte
	rst  int
}

func TestQuality(t *testing.T) {

	cases := []quantTbls{
		{
			[2][]byte{
				{0, 8, 6, 6, 7, 6, 5, 8, 7, 7, 7, 9, 9, 8, 10, 12, 20, 13, 12, 11, 11, 12, 25, 18, 19, 15, 20, 29, 26, 31, 30, 29, 26, 28, 28, 32, 36, 46, 39, 32, 34, 44, 35, 28, 28, 40, 55, 41, 44, 48, 49, 52, 52, 52, 31, 39, 57, 61, 56, 50, 60, 46, 51, 52, 50},
				{1, 9, 9, 9, 12, 11, 12, 24, 13, 13, 24, 50, 33, 28, 33, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50},
			},
			75,
		},
		{
			[2][]byte{
				{0, 27, 18, 20, 23, 20, 17, 27, 23, 22, 23, 30, 28, 27, 32, 40, 66, 43, 40, 37, 37, 40, 81, 58, 61, 48, 66, 96, 85, 101, 100, 95, 85, 93, 91, 106, 120, 153, 129, 106, 113, 144, 115, 91, 93, 133, 181, 134, 144, 158, 163, 171, 173, 171, 103, 128, 188, 201, 186, 166, 199, 153, 168, 171, 164},
				{1, 28, 30, 30, 40, 35, 40, 78, 43, 43, 78, 164, 110, 93, 110, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164},
			},
			30,
		},
	}

	for _, cs := range cases {
		ctx := &qualityCtx{}
		for _, tbl := range cs.tbls {
			if len(tbl) > 0 {
				ctx.accept(tbl)
			}
		}

		assert.Equal(t, cs.rst, ctx.result())
	}
}
